diff -N -r -u -w rpm-4.15.0/lib/rpmfi.c rpm-4.15.0-patched/lib/rpmfi.c
--- rpm-4.15.0/lib/rpmfi.c	2019-06-26 15:17:31.413985000 +0000
+++ rpm-4.15.0-patched/lib/rpmfi.c	2019-10-22 19:26:22.061266960 +0000
@@ -1357,6 +1357,21 @@
 
 /* Get file data from header */
 /* Requires totalfc to be set and label err: to goto on error */
+#if defined(__sgi)
+#define _hgfi(_h, _tag, _td, _flags, _data) \
+    if (headerGet((_h), (_tag), (_td), (_flags))) { \
+	if (rpmtdCount(_td) != totalfc) { \
+	    rpmlog(RPMLOG_ERR, _("Wrong number of entries for tag %s: %u found but %u expected.\n"), rpmTagGetName(_tag), rpmtdCount(_td), totalfc); \
+	    goto err; \
+	} \
+	if (rpmTagGetTagType(_tag) != RPM_STRING_ARRAY_TYPE && rpmTagGetTagType(_tag) != RPM_I18NSTRING_TYPE && \
+	    (_td)->size < totalfc * sizeof(*(_data))) {		\
+	    rpmlog(RPMLOG_ERR, _("Malformed data for tag %s: %u bytes found but %u expected.\n"), rpmTagGetName(_tag), (_td)->size, totalfc * sizeof(*(_data))); \
+	    goto err;				\
+	} \
+	_data = ((_td)->data); \
+    }
+#else
 #define _hgfi(_h, _tag, _td, _flags, _data) \
     if (headerGet((_h), (_tag), (_td), (_flags))) { \
 	if (rpmtdCount(_td) != totalfc) { \
@@ -1370,6 +1385,7 @@
 	} \
 	_data = ((_td)->data); \
     }
+#endif
 /* Get file data from header without checking number of entries */
 #define _hgfinc(_h, _tag, _td, _flags, _data) \
     if (headerGet((_h), (_tag), (_td), (_flags))) {\
diff -N -r -u -w rpm-4.15.0/lib/rpmrc.c rpm-4.15.0-patched/lib/rpmrc.c
--- rpm-4.15.0/lib/rpmrc.c	2019-06-26 15:17:31.416985000 +0000
+++ rpm-4.15.0-patched/lib/rpmrc.c	2019-10-22 19:27:44.438749520 +0000
@@ -1041,6 +1041,12 @@
 	    strcpy(un.machine, __power_pc() ? "ppc" : "rs6000");
 	    sprintf(un.sysname,"aix%s.%s", un.version, un.release);
 	}
+	else if (rstreq(un.sysname, "IRIX64")) {
+	    strcpy(un.machine, "mips");
+	    /*make un.sysname look like irix6.5 for example*/
+	    /*sprintf(un.sysname, "irix%s", strpbrk(un.release, "123456789"));*/
+	    sprintf(un.sysname, "irix");
+	}
 	else if (rstreq(un.sysname, "Darwin")) { 
 #if defined(__ppc__)
 	    strcpy(un.machine, "ppc");
@@ -1048,7 +1054,7 @@
 	    strcpy(un.machine, "i386");
 #elif defined(__x86_64__)
 	    strcpy(un.machine, "x86_64");
-#else
+#elif !defined(__sgi)
 	    #warning "No architecture defined! Automatic detection may not work!"
 #endif 
 	}
diff -N -r -u -w rpm-4.15.0/lib/rpmscript.c rpm-4.15.0-patched/lib/rpmscript.c
--- rpm-4.15.0/lib/rpmscript.c	2019-06-26 15:17:31.416985000 +0000
+++ rpm-4.15.0-patched/lib/rpmscript.c	2019-10-22 19:26:22.066642800 +0000
@@ -370,8 +370,13 @@
 	   sname, (unsigned)pid, (unsigned)reaped, status);
 
     if (reaped < 0) {
+#if defined(__sgi)
+	rpmlog(lvl, _("%s scriptlet failed, waitpid(%ld) rc %ld: %s\n"),
+		 sname, pid, reaped, strerror(errno));
+#else
 	rpmlog(lvl, _("%s scriptlet failed, waitpid(%d) rc %d: %s\n"),
 		 sname, pid, reaped, strerror(errno));
+#endif
     } else if (!WIFEXITED(status) || WEXITSTATUS(status)) {
       	if (WIFSIGNALED(status)) {
 	    rpmlog(lvl, _("%s scriptlet failed, signal %d\n"),
diff -N -r -u -w rpm-4.15.0/lib/transaction.c rpm-4.15.0-patched/lib/transaction.c
--- rpm-4.15.0/lib/transaction.c	2019-09-09 08:56:53.270788000 +0000
+++ rpm-4.15.0-patched/lib/transaction.c	2019-10-22 19:26:22.069865520 +0000
@@ -1311,7 +1311,11 @@
 
     /* The ordering doesn't matter here */
     /* XXX Only added packages need be checked. */
+#if defined(__sgi)
+    rpmlog(RPMLOG_DEBUG, "sanity checking %llu elements\n", npkgs);
+#else
     rpmlog(RPMLOG_DEBUG, "sanity checking %lu elements\n", npkgs);
+#endif
     pi = rpmtsiInit(ts);
     while ((p = rpmtsiNext(pi, TR_ADDED)) != NULL) {
 
diff -N -r -u -w rpm-4.15.0/luaext/lrexlib.c rpm-4.15.0-patched/luaext/lrexlib.c
--- rpm-4.15.0/luaext/lrexlib.c	2019-06-26 15:17:31.419985000 +0000
+++ rpm-4.15.0-patched/luaext/lrexlib.c	2019-10-22 19:26:22.071381600 +0000
@@ -7,6 +7,10 @@
 #include <stdlib.h>
 #include <string.h>
 
+#if defined(__sgi)
+#include <regex.h>
+#endif
+
 #include "lua.h"
 #include "lauxlib.h"
 #include "lrexlib.h"
@@ -31,7 +35,7 @@
   int res;
   regex_t *pr = (regex_t *)lua_newuserdata(L, sizeof(regex_t));
   pattern = luaL_checklstring(L, 1, &l);
-#ifdef REG_BASIC
+#if defined(REG_BASIC) && !defined(__sgi)
   pr->re_endp = pattern + lua_strlen(L, 1);
   res = regcomp(pr, pattern, REG_EXTENDED | REG_PEND);
 #else
diff -N -r -u -w rpm-4.15.0/macros.in rpm-4.15.0-patched/macros.in
--- rpm-4.15.0/macros.in	2019-09-09 08:56:53.273788000 +0000
+++ rpm-4.15.0-patched/macros.in	2019-10-22 19:27:55.150897760 +0000
@@ -147,7 +147,7 @@
 %_builddir		%{_topdir}/BUILD
 
 #	The interpreter used for build scriptlets.
-%_buildshell		/bin/sh
+%_buildshell		%{_bindir}/sh
 
 #	The path to the bzip2 executable (legacy, use %{__bzip2} instead).
 %_bzip2bin		%{__bzip2}
diff -N -r -u -w rpm-4.15.0/misc/fts.c rpm-4.15.0-patched/misc/fts.c
--- rpm-4.15.0/misc/fts.c	2019-06-26 15:17:31.420985000 +0000
+++ rpm-4.15.0-patched/misc/fts.c	2019-10-22 19:26:22.073601760 +0000
@@ -51,6 +51,12 @@
 #else
 
 /* Conditionals for working around non-GNU environments */
+#if defined(__sgi)
+#include <sys/types.h>
+#define dirfd(dirp)	((dirp)->dd_fd)
+#   define        _INCLUDE_POSIX_SOURCE
+#   define __errno_location() 	(&errno)
+#endif
 #if defined(hpux)
 #   define        _INCLUDE_POSIX_SOURCE
 #   define __errno_location() 	(&errno)
diff -N -r -u -w rpm-4.15.0/python/header-py.c rpm-4.15.0-patched/python/header-py.c
--- rpm-4.15.0/python/header-py.c	2019-09-26 10:44:40.739644000 +0000
+++ rpm-4.15.0-patched/python/header-py.c	2019-10-22 19:26:22.076155280 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <rpm/rpmlib.h>		/* rpmvercmp */
diff -N -r -u -w rpm-4.15.0/python/rpmarchive-py.c rpm-4.15.0-patched/python/rpmarchive-py.c
--- rpm-4.15.0/python/rpmarchive-py.c	2019-06-26 15:17:31.443985000 +0000
+++ rpm-4.15.0-patched/python/rpmarchive-py.c	2019-10-22 19:26:22.077912080 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <rpm/rpmtypes.h>
diff -N -r -u -w rpm-4.15.0/python/rpmds-py.c rpm-4.15.0-patched/python/rpmds-py.c
--- rpm-4.15.0/python/rpmds-py.c	2019-09-26 10:44:40.739644000 +0000
+++ rpm-4.15.0-patched/python/rpmds-py.c	2019-10-22 19:26:22.079828000 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <rpm/rpmtypes.h>
diff -N -r -u -w rpm-4.15.0/python/rpmfd-py.c rpm-4.15.0-patched/python/rpmfd-py.c
--- rpm-4.15.0/python/rpmfd-py.c	2019-09-26 10:44:40.739644000 +0000
+++ rpm-4.15.0-patched/python/rpmfd-py.c	2019-10-22 19:26:22.081555280 +0000
@@ -1,3 +1,9 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
 
 #include "rpmsystem-py.h"
 #include <rpm/rpmstring.h>
diff -N -r -u -w rpm-4.15.0/python/rpmfi-py.c rpm-4.15.0-patched/python/rpmfi-py.c
--- rpm-4.15.0/python/rpmfi-py.c	2019-09-26 10:44:40.739644000 +0000
+++ rpm-4.15.0-patched/python/rpmfi-py.c	2019-10-22 19:26:22.083327760 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <rpm/rpmtypes.h>
diff -N -r -u -w rpm-4.15.0/python/rpmfiles-py.c rpm-4.15.0-patched/python/rpmfiles-py.c
--- rpm-4.15.0/python/rpmfiles-py.c	2019-09-26 10:44:40.739644000 +0000
+++ rpm-4.15.0-patched/python/rpmfiles-py.c	2019-10-22 19:26:22.085263280 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <rpm/rpmtypes.h>
diff -N -r -u -w rpm-4.15.0/python/rpmii-py.c rpm-4.15.0-patched/python/rpmii-py.c
--- rpm-4.15.0/python/rpmii-py.c	2019-09-26 10:44:40.739644000 +0000
+++ rpm-4.15.0-patched/python/rpmii-py.c	2019-10-22 19:26:22.086812400 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <rpm/rpmdb.h>
diff -N -r -u -w rpm-4.15.0/python/rpmkeyring-py.c rpm-4.15.0-patched/python/rpmkeyring-py.c
--- rpm-4.15.0/python/rpmkeyring-py.c	2019-06-26 15:17:31.444985000 +0000
+++ rpm-4.15.0-patched/python/rpmkeyring-py.c	2019-10-22 19:26:22.088547920 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 #include <rpm/rpmkeyring.h>
 #include "rpmkeyring-py.h"
diff -N -r -u -w rpm-4.15.0/python/rpmmacro-py.c rpm-4.15.0-patched/python/rpmmacro-py.c
--- rpm-4.15.0/python/rpmmacro-py.c	2019-06-26 15:17:31.444985000 +0000
+++ rpm-4.15.0-patched/python/rpmmacro-py.c	2019-10-22 19:26:22.090001280 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <rpm/rpmmacro.h>
diff -N -r -u -w rpm-4.15.0/python/rpmmi-py.c rpm-4.15.0-patched/python/rpmmi-py.c
--- rpm-4.15.0/python/rpmmi-py.c	2019-09-26 10:44:40.740644000 +0000
+++ rpm-4.15.0-patched/python/rpmmi-py.c	2019-10-22 19:26:22.091548720 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <rpm/rpmdb.h>
diff -N -r -u -w rpm-4.15.0/python/rpmmodule.c rpm-4.15.0-patched/python/rpmmodule.c
--- rpm-4.15.0/python/rpmmodule.c	2019-09-26 10:44:40.740644000 +0000
+++ rpm-4.15.0-patched/python/rpmmodule.c	2019-10-22 19:26:22.093561840 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <rpm/rpmlib.h>		/* rpmMachineScore, rpmReadConfigFiles */
diff -N -r -u -w rpm-4.15.0/python/rpmps-py.c rpm-4.15.0-patched/python/rpmps-py.c
--- rpm-4.15.0/python/rpmps-py.c	2019-06-26 15:17:31.444985000 +0000
+++ rpm-4.15.0-patched/python/rpmps-py.c	2019-10-22 19:26:22.095208000 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include "rpmps-py.h"
diff -N -r -u -w rpm-4.15.0/python/rpmstrpool-py.c rpm-4.15.0-patched/python/rpmstrpool-py.c
--- rpm-4.15.0/python/rpmstrpool-py.c	2019-06-26 15:17:31.444985000 +0000
+++ rpm-4.15.0-patched/python/rpmstrpool-py.c	2019-10-22 19:26:22.096704560 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 #include <rpm/rpmstrpool.h>
 #include "rpmstrpool-py.h"
diff -N -r -u -w rpm-4.15.0/python/rpmtd-py.c rpm-4.15.0-patched/python/rpmtd-py.c
--- rpm-4.15.0/python/rpmtd-py.c	2019-06-26 15:17:31.444985000 +0000
+++ rpm-4.15.0-patched/python/rpmtd-py.c	2019-10-22 19:26:22.098123760 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 /** \ingroup py_c
  * \file python/rpmtd-py.c
  */
diff -N -r -u -w rpm-4.15.0/python/rpmte-py.c rpm-4.15.0-patched/python/rpmte-py.c
--- rpm-4.15.0/python/rpmte-py.c	2019-06-26 15:17:31.444985000 +0000
+++ rpm-4.15.0-patched/python/rpmte-py.c	2019-10-22 19:26:22.099749680 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include "header-py.h"	/* XXX tagNumFromPyObject */
diff -N -r -u -w rpm-4.15.0/python/rpmts-py.c rpm-4.15.0-patched/python/rpmts-py.c
--- rpm-4.15.0/python/rpmts-py.c	2019-09-26 10:44:40.740644000 +0000
+++ rpm-4.15.0-patched/python/rpmts-py.c	2019-10-22 19:26:22.102172960 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include <fcntl.h>
diff -N -r -u -w rpm-4.15.0/python/spec-py.c rpm-4.15.0-patched/python/spec-py.c
--- rpm-4.15.0/python/spec-py.c	2019-06-26 15:17:31.445985000 +0000
+++ rpm-4.15.0-patched/python/spec-py.c	2019-10-22 19:26:22.104068560 +0000
@@ -1,3 +1,10 @@
+#if defined(__sgi)
+#include <unistd.h>
+#undef _ABIAPI
+#include <sys/time.h>
+#define _ABIAPI 1
+#endif
+
 #include "rpmsystem-py.h"
 
 #include "rpmts-py.h"
diff -N -r -u -w rpm-4.15.0/rpmio/macro.c rpm-4.15.0-patched/rpmio/macro.c
--- rpm-4.15.0/rpmio/macro.c	2019-09-09 08:56:53.374788000 +0000
+++ rpm-4.15.0-patched/rpmio/macro.c	2019-10-22 19:26:22.107106960 +0000
@@ -512,7 +512,11 @@
 #endif
     /* Fallback to sysconf() if the above isn't supported or didn't work */
     if (ncpus < 1)
+#if defined(__sgi)
+	ncpus = sysconf(_SC_NPROC_ONLN);
+#else
 	ncpus = sysconf(_SC_NPROCESSORS_ONLN);
+#endif
     /* If all else fails, there's always the one we're running on... */
     if (ncpus < 1)
 	ncpus = 1;
diff -N -r -u -w rpm-4.15.0/rpmio/rpmfileutil.c rpm-4.15.0-patched/rpmio/rpmfileutil.c
--- rpm-4.15.0/rpmio/rpmfileutil.c	2019-06-26 15:17:31.447985000 +0000
+++ rpm-4.15.0-patched/rpmio/rpmfileutil.c	2019-10-22 19:26:22.108632000 +0000
@@ -127,7 +127,11 @@
 	    rc = mkdir(d, mode);
 	    if (rc)
 		goto exit;
+#if defined(__sgi)
+	    rpmlog(RPMLOG_DEBUG, "created directory(s) %s mode 0%lo\n", path, mode);
+#else
 	    rpmlog(RPMLOG_DEBUG, "created directory(s) %s mode 0%o\n", path, mode);
+#endif
 	    if (!(uid == (uid_t) -1 && gid == (gid_t) -1)) {
 		rc = chown(d, uid, gid);
 		if (rc)
diff -N -r -u -w rpm-4.15.0/rpmio/rpmsq.c rpm-4.15.0-patched/rpmio/rpmsq.c
--- rpm-4.15.0/rpmio/rpmsq.c	2019-06-26 15:17:31.450985000 +0000
+++ rpm-4.15.0-patched/rpmio/rpmsq.c	2019-10-22 19:26:22.109938880 +0000
@@ -34,7 +34,11 @@
     } else {
 	int lvl = (signum == SIGPIPE) ? RPMLOG_DEBUG : RPMLOG_WARNING;
 	rpmlog(lvl,
+#if defined(__sgi)
+		_("exiting on signal %d from pid %ld\n"), signum, info->si_pid);
+#else
 		_("exiting on signal %d from pid %d\n"), signum, info->si_pid);
+#endif
     }
     /* exit 128 + signum for compatibility with bash(1) */
     exit(128 + signum);
diff -N -r -u -w rpm-4.15.0/scripts/brp-compress rpm-4.15.0-patched/scripts/brp-compress
--- rpm-4.15.0/scripts/brp-compress	2019-09-09 08:56:53.375788000 +0000
+++ rpm-4.15.0-patched/scripts/brp-compress	2019-10-22 19:26:22.111255680 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 # If using normal root, avoid changing anything.
 if [ -z "$RPM_BUILD_ROOT" ] || [ "$RPM_BUILD_ROOT" = "/" ]; then
diff -N -r -u -w rpm-4.15.0/scripts/brp-java-gcjcompile rpm-4.15.0-patched/scripts/brp-java-gcjcompile
--- rpm-4.15.0/scripts/brp-java-gcjcompile	2019-09-09 08:56:53.375788000 +0000
+++ rpm-4.15.0-patched/scripts/brp-java-gcjcompile	2019-10-22 19:26:22.112476640 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 # If using normal root, avoid changing anything.
 [ -z "$RPM_BUILD_ROOT" ] || [ "$RPM_BUILD_ROOT" = "/" ] && exit 0
diff -N -r -u -w rpm-4.15.0/scripts/brp-python-hardlink rpm-4.15.0-patched/scripts/brp-python-hardlink
--- rpm-4.15.0/scripts/brp-python-hardlink	2019-09-09 08:56:53.375788000 +0000
+++ rpm-4.15.0-patched/scripts/brp-python-hardlink	2019-10-22 19:26:22.113868000 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 # If using normal root, avoid changing anything.
 if [ -z "$RPM_BUILD_ROOT" ] || [ "$RPM_BUILD_ROOT" = "/" ]; then
diff -N -r -u -w rpm-4.15.0/scripts/brp-strip rpm-4.15.0-patched/scripts/brp-strip
--- rpm-4.15.0/scripts/brp-strip	2019-09-09 08:56:53.375788000 +0000
+++ rpm-4.15.0-patched/scripts/brp-strip	2019-10-22 19:26:22.115022320 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 # If using normal root, avoid changing anything.
 if [ -z "$RPM_BUILD_ROOT" ] || [ "$RPM_BUILD_ROOT" = "/" ]; then
 	exit 0
diff -N -r -u -w rpm-4.15.0/scripts/brp-strip-comment-note rpm-4.15.0-patched/scripts/brp-strip-comment-note
--- rpm-4.15.0/scripts/brp-strip-comment-note	2019-09-09 08:56:53.375788000 +0000
+++ rpm-4.15.0-patched/scripts/brp-strip-comment-note	2019-10-22 19:26:22.116228000 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 # If using normal root, avoid changing anything.
 if [ -z "$RPM_BUILD_ROOT" ] || [ "$RPM_BUILD_ROOT" = "/" ]; then
 	exit 0
diff -N -r -u -w rpm-4.15.0/scripts/brp-strip-shared rpm-4.15.0-patched/scripts/brp-strip-shared
--- rpm-4.15.0/scripts/brp-strip-shared	2019-09-09 08:56:53.376788000 +0000
+++ rpm-4.15.0-patched/scripts/brp-strip-shared	2019-10-22 19:26:22.117415920 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 # Conectiva brp - strip shared libraries. Based on Red Hat's brp-strip.
 # Thu Apr 20 - Guilherme Manika <gwm@conectiva.com.br>
 #              Created file
diff -N -r -u -w rpm-4.15.0/scripts/brp-strip-static-archive rpm-4.15.0-patched/scripts/brp-strip-static-archive
--- rpm-4.15.0/scripts/brp-strip-static-archive	2019-09-09 08:56:53.376788000 +0000
+++ rpm-4.15.0-patched/scripts/brp-strip-static-archive	2019-10-22 19:26:22.118712960 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 if [ -z "$RPM_BUILD_ROOT" ] || [ "$RPM_BUILD_ROOT" = "/" ]; then
 	exit 0
diff -N -r -u -w rpm-4.15.0/scripts/check-buildroot rpm-4.15.0-patched/scripts/check-buildroot
--- rpm-4.15.0/scripts/check-buildroot	2019-09-09 08:56:53.376788000 +0000
+++ rpm-4.15.0-patched/scripts/check-buildroot	2019-10-22 19:26:22.119941280 +0000
@@ -1,4 +1,4 @@
-#! /bin/sh
+#! /usr/bin/env sh
 
 # Copyright (C) 2004 Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
 #  
diff -N -r -u -w rpm-4.15.0/scripts/check-files rpm-4.15.0-patched/scripts/check-files
--- rpm-4.15.0/scripts/check-files	2019-06-26 15:17:31.452985000 +0000
+++ rpm-4.15.0-patched/scripts/check-files	2019-10-22 19:26:22.121124640 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 #
 # Gets file list on standard input and RPM_BUILD_ROOT as first parameter
 # and searches for omitted files (not counting directories).
diff -N -r -u -w rpm-4.15.0/scripts/check-rpaths rpm-4.15.0-patched/scripts/check-rpaths
--- rpm-4.15.0/scripts/check-rpaths	2019-09-09 08:56:53.376788000 +0000
+++ rpm-4.15.0-patched/scripts/check-rpaths	2019-10-22 19:26:22.122260720 +0000
@@ -1,4 +1,4 @@
-#! /bin/sh
+#! /usr/bin/env sh
 
 # Copyright (C) 2004 Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
 #  
diff -N -r -u -w rpm-4.15.0/scripts/debuginfo.prov rpm-4.15.0-patched/scripts/debuginfo.prov
--- rpm-4.15.0/scripts/debuginfo.prov	2019-06-26 15:17:31.452985000 +0000
+++ rpm-4.15.0-patched/scripts/debuginfo.prov	2019-10-22 19:26:22.123516000 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 while read instfile; do
   case "$instfile" in
diff -N -r -u -w rpm-4.15.0/scripts/desktop-file.prov rpm-4.15.0-patched/scripts/desktop-file.prov
--- rpm-4.15.0/scripts/desktop-file.prov	2019-06-26 15:17:31.452985000 +0000
+++ rpm-4.15.0-patched/scripts/desktop-file.prov	2019-10-22 19:26:22.125094880 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 #
 # Transform desktop mimetype info into RPM mimehandler(type) provides
 #
diff -N -r -u -w rpm-4.15.0/scripts/find-provides rpm-4.15.0-patched/scripts/find-provides
--- rpm-4.15.0/scripts/find-provides	2019-06-26 15:17:31.453985000 +0000
+++ rpm-4.15.0-patched/scripts/find-provides	2019-10-22 19:26:22.126220960 +0000
@@ -1,3 +1,3 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 /usr/lib/rpm/rpmdeps --define="_use_internal_dependency_generator 1" --provides
diff -N -r -u -w rpm-4.15.0/scripts/find-provides.php rpm-4.15.0-patched/scripts/find-provides.php
--- rpm-4.15.0/scripts/find-provides.php	2019-06-26 15:17:31.453985000 +0000
+++ rpm-4.15.0-patched/scripts/find-provides.php	2019-10-22 19:26:22.127382800 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 if [ $# -lt 1 ]; then
 	echo "You have to specify input file"
 	exit 1
diff -N -r -u -w rpm-4.15.0/scripts/find-requires rpm-4.15.0-patched/scripts/find-requires
--- rpm-4.15.0/scripts/find-requires	2019-06-26 15:17:31.453985000 +0000
+++ rpm-4.15.0-patched/scripts/find-requires	2019-10-22 19:26:22.128547280 +0000
@@ -1,3 +1,3 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 /usr/lib/rpm/rpmdeps --define="_use_internal_dependency_generator 1" --requires
diff -N -r -u -w rpm-4.15.0/scripts/find-requires.php rpm-4.15.0-patched/scripts/find-requires.php
--- rpm-4.15.0/scripts/find-requires.php	2019-06-26 15:17:31.453985000 +0000
+++ rpm-4.15.0-patched/scripts/find-requires.php	2019-10-22 19:26:22.129766000 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 #####################################################################
 #                                                                   #
 # Check system dependences between php-pear modules                 #
diff -N -r -u -w rpm-4.15.0/scripts/gendiff rpm-4.15.0-patched/scripts/gendiff
--- rpm-4.15.0/scripts/gendiff	2019-09-09 08:56:53.377788000 +0000
+++ rpm-4.15.0-patched/scripts/gendiff	2019-10-22 19:26:22.131083040 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 [ -z "$1" ] || [ -z "$2" ] && {
 # usage
diff -N -r -u -w rpm-4.15.0/scripts/libtooldeps.sh rpm-4.15.0-patched/scripts/libtooldeps.sh
--- rpm-4.15.0/scripts/libtooldeps.sh	2019-06-26 15:17:31.453985000 +0000
+++ rpm-4.15.0-patched/scripts/libtooldeps.sh	2019-10-22 19:26:22.132268560 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 [ $# -ge 2 ] || {
     cat > /dev/null
diff -N -r -u -w rpm-4.15.0/scripts/metainfo.prov rpm-4.15.0-patched/scripts/metainfo.prov
--- rpm-4.15.0/scripts/metainfo.prov	2019-06-26 15:17:31.453985000 +0000
+++ rpm-4.15.0-patched/scripts/metainfo.prov	2019-10-22 19:26:22.133471040 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 #
 # Transform appdata/metainfo xml file into RPM metainfo(filename) provides
 #
diff -N -r -u -w rpm-4.15.0/scripts/ocaml-find-provides.sh rpm-4.15.0-patched/scripts/ocaml-find-provides.sh
--- rpm-4.15.0/scripts/ocaml-find-provides.sh	2019-06-26 15:17:31.453985000 +0000
+++ rpm-4.15.0-patched/scripts/ocaml-find-provides.sh	2019-10-22 19:26:22.134670160 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh -
+#!/usr/bin/env sh -
 # OCaml-specific "find-provides" for RPM.
 # By Richard W.M. Jones <rjones@redhat.com>
 # $Id: ocaml-find-provides.sh,v 1.2 2007/09/06 11:49:59 rjones Exp $
diff -N -r -u -w rpm-4.15.0/scripts/ocaml-find-requires.sh rpm-4.15.0-patched/scripts/ocaml-find-requires.sh
--- rpm-4.15.0/scripts/ocaml-find-requires.sh	2019-06-26 15:17:31.453985000 +0000
+++ rpm-4.15.0-patched/scripts/ocaml-find-requires.sh	2019-10-22 19:26:22.136044400 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh -
+#!/usr/bin/env sh -
 # OCaml-specific "find-requires" for RPM.
 # By Richard W.M. Jones <rjones@redhat.com>
 # $Id: ocaml-find-requires.sh,v 1.5 2009/10/04 22:34:51 rjones Exp $
diff -N -r -u -w rpm-4.15.0/scripts/rpm.daily rpm-4.15.0-patched/scripts/rpm.daily
--- rpm-4.15.0/scripts/rpm.daily	2019-06-26 15:17:31.454985000 +0000
+++ rpm-4.15.0-patched/scripts/rpm.daily	2019-10-22 19:26:22.137204400 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 tmpfile=`/bin/mktemp /var/log/rpmpkgs.XXXXXXXXX` || exit 1
 /bin/rpm -qa --qf '%{name}-%{version}-%{release}.%{arch}.rpm\n' 2>&1 \
diff -N -r -u -w rpm-4.15.0/scripts/rpm2cpio.sh rpm-4.15.0-patched/scripts/rpm2cpio.sh
--- rpm-4.15.0/scripts/rpm2cpio.sh	2019-09-09 08:56:53.377788000 +0000
+++ rpm-4.15.0-patched/scripts/rpm2cpio.sh	2019-10-22 19:26:22.138375600 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh -efu
+#!/usr/bin/env sh -efu
 
 fatal() {
 	echo "$*" >&2
diff -N -r -u -w rpm-4.15.0/scripts/script.req rpm-4.15.0-patched/scripts/script.req
--- rpm-4.15.0/scripts/script.req	2019-06-26 15:17:31.454985000 +0000
+++ rpm-4.15.0-patched/scripts/script.req	2019-10-22 19:26:22.139480880 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 # TODO: handle "#!/usr/bin/env foo" somehow
 while read filename; do
diff -N -r -u -w rpm-4.15.0/scripts/tgpg rpm-4.15.0-patched/scripts/tgpg
--- rpm-4.15.0/scripts/tgpg	2019-09-09 08:56:53.377788000 +0000
+++ rpm-4.15.0-patched/scripts/tgpg	2019-10-22 19:26:22.140625840 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 
 for pkg in $*
diff -N -r -u -w rpm-4.15.0/scripts/vpkg-provides.sh rpm-4.15.0-patched/scripts/vpkg-provides.sh
--- rpm-4.15.0/scripts/vpkg-provides.sh	2019-06-26 15:17:31.454985000 +0000
+++ rpm-4.15.0-patched/scripts/vpkg-provides.sh	2019-10-22 19:26:22.142138880 +0000
@@ -1,4 +1,4 @@
-#!/bin/sh
+#!/usr/bin/env sh
 
 #
 # Original Author: Tim Mooney (mooney@plains.NoDak.edu)
diff -N -r -u -w rpm-4.15.0/system.h rpm-4.15.0-patched/system.h
--- rpm-4.15.0/system.h	2019-06-26 15:17:31.455985000 +0000
+++ rpm-4.15.0-patched/system.h	2019-10-22 19:26:22.143440560 +0000
@@ -102,6 +102,9 @@
 # include <stdlib.h> /* Make sure this header is included */
 # define xsetprogname(pn) setprogname(pn)
 # define xgetprogname(pn) getprogname(pn)
+#elif defined(__sgi)
+# define xsetprogname(pn)
+# define xgetprogname(pn) getprogname(pn)
 #elif defined(HAVE___PROGNAME) /* glibc and others */
 # define xsetprogname(pn)
   extern const char *__progname;
